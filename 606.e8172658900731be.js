"use strict";(self.webpackChunkseaskyCMS=self.webpackChunkseaskyCMS||[]).push([[606],{606:(j,z,s)=>{s.r(z),s.d(z,{EditProcessModule:()=>R});var v=s(4755),m=s(1195),g=s(5861),r=s(5030),Q=s(9751),F=s(2340),n=s(2223),I=s(131),P=s(3272),h=s(8397),S=s(1401),A=s(2242),C=s(4247),Z=s(4839),y=s(6681),T=s(1929),l=s(4701),J=s(2701),L=s(3068);function B(e,i){if(1&e&&(n.ynx(0),n._UZ(1,"span",18),n.TgZ(2,"div",19),n._uU(3,"Upload"),n.qZA(),n.BQk()),2&e){const t=n.oxw();n.xp6(1),n.Q6J("nzType",t.isImgLoading?"loading":"plus")}}function X(e,i){if(1&e&&n._UZ(0,"img",20),2&e){const t=n.oxw();n.Q6J("src",t.form.value.img,n.LSH)}}const M=function(){return[".png",".jpg"]},D=[{path:"",component:(()=>{class e{constructor(t,o,a,d,u){this.router=t,this.route=o,this.supabase=a,this.message=d,this.fb=u,this.id="",this.isLoading=!1,this.isImgLoading=!1,this.transformFile=x=>new Q.y(E=>{const f=new FileReader;f.readAsDataURL(x),this.uploadImages(x),f.onload=()=>{const U=document.createElement("canvas"),p=document.createElement("img");p.src=f.result,p.onload=()=>{const c=U.getContext("2d");c.drawImage(p,0,0),c.fillStyle="red",c.textBaseline="middle",c.fillText("Ant Design",20,20),U.toBlob(b=>{E.next(b),E.complete()})}}})}ngOnInit(){this.id=this.route.snapshot.params.id||"",this.form=this.fb.group({id:[null],created_at:[null],updated_at:[null],title:[null,[r.kI.required]],desc:[null,[r.kI.required]],img:[null,[r.kI.required]]}),this.id&&this.getDetails(+this.id)}getDetails(t){var o=this;return(0,g.Z)(function*(){o.isLoading=!0;const{data:a,error:d}=yield o.supabase.get("process",t,!0);d&&o.message.error(d.message),console.log(a),o.form.setValue({...a}),o.isLoading=!1})()}goBack(){this.router.navigateByUrl("process")}submitForm(){var t=this;return(0,g.Z)(function*(){if(t.form.valid){console.log(t.form.value);const{error:o}=yield t.supabase.upsert("process",t.form.value);o?t.message.error(o.message):(t.message.success("Success"),t.goBack())}else Object.values(t.form.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}))})})()}uploadImages(t){var o=this;return(0,g.Z)(function*(){const a=t.name.split(".").pop(),d=`${Math.random()}.${a}`;o.isImgLoading=!0;const{error:u}=yield o.supabase.uploadImages(d,t);u&&o.message.error(u.message),o.form.value.img=`${F.N.storageUrl}${d}`,o.form.setValue({...o.form.value}),o.isImgLoading=!1})()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(m.F0),n.Y36(m.gz),n.Y36(I.T),n.Y36(P.dD),n.Y36(r.QS))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-edit-process"]],decls:29,vars:23,consts:[[3,"nzSpinning"],[1,"header-wrap"],[1,"header-title"],["nz-button","","nzType","primary",1,"header-button",3,"click"],[1,"content-wrap"],["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","title",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nz-input","","formControlName","title","id","title"],["nzRequired","","nzFor","desc",3,"nzSm","nzXs"],["nz-input","","formControlName","desc","id","desc"],["nzRequired","","nzFor","img",3,"nzSm","nzXs"],["nzListType","picture-card",1,"uploader",3,"nzShowUploadList","nzAccept","nzTransformFile"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"nzLoading"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(t,o){1&t&&(n.TgZ(0,"nz-spin",0)(1,"div",1),n._UZ(2,"div",2),n.TgZ(3,"button",3),n.NdJ("click",function(){return o.goBack()}),n._uU(4,"\u623b\u3063\u3066"),n.qZA()(),n._UZ(5,"nz-divider"),n.TgZ(6,"div",4)(7,"form",5),n.NdJ("ngSubmit",function(){return o.submitForm()}),n.TgZ(8,"nz-form-item")(9,"nz-form-label",6),n._uU(10,"Title"),n.qZA(),n.TgZ(11,"nz-form-control",7),n._UZ(12,"input",8),n.qZA()(),n.TgZ(13,"nz-form-item")(14,"nz-form-label",9),n._uU(15,"Description"),n.qZA(),n.TgZ(16,"nz-form-control",7),n._UZ(17,"input",10),n.qZA()(),n.TgZ(18,"nz-form-item")(19,"nz-form-label",11),n._uU(20,"Image"),n.qZA(),n.TgZ(21,"nz-form-control",7)(22,"nz-upload",12),n.YNc(23,B,4,1,"ng-container",13),n.YNc(24,X,1,1,"img",14),n.qZA()()(),n.TgZ(25,"nz-form-item",15)(26,"nz-form-control",16)(27,"button",17),n._uU(28,"\u4fdd\u5b58"),n.qZA()()()()()()),2&t&&(n.Q6J("nzSpinning",o.isLoading),n.xp6(7),n.Q6J("formGroup",o.form),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(1),n.Q6J("nzShowUploadList",!1)("nzAccept",n.DdM(22,M))("nzTransformFile",o.transformFile),n.xp6(1),n.Q6J("ngIf",!o.form.value.img),n.xp6(1),n.Q6J("ngIf",o.form.value.img),n.xp6(2),n.Q6J("nzSpan",14)("nzOffset",6),n.xp6(1),n.Q6J("nzLoading",o.isLoading||o.isImgLoading))},dependencies:[v.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,h.Zp,S.ix,A.w,C.dQ,Z.g,y.W,T.t3,T.SK,l.Lr,l.Nx,l.iK,l.Fd,J.Ls,L.FY]}),e})()}];let Y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[m.Bz.forChild(D),m.Bz]}),e})();var N=s(3174);let R=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[v.ez,Y,r.UX,h.o7,S.sL,Z.S,N.HQ,y.j,l.U5,J.PV,L.cS]}),e})()}}]);